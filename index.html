<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>WebAR Experience | Instant AR Demo</title>
    
    <!-- Open Graph Meta Tags for QR Code Preview -->
    <meta property="og:title" content="WebAR Experience - Tap to Launch AR">
    <meta property="og:description" content="Instant browser-based AR. No app required.">
    <meta property="og:image" content="/assets/preview.png">
    
    <!-- A-Frame Core (WebXR + VR/AR Support) -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <!-- AR.js for Marker-based fallback -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
    
    <!-- Gesture Detector Component (Touch interactions) -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner">
                <svg viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="#00ff88" stroke-width="3" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)">
                        <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
            <h2>Initializing AR Experience</h2>
            <p id="loading-message">Preparing your device...</p>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- Unsupported Device Fallback -->
    <div id="fallback-screen" class="fallback-screen" style="display: none;">
        <div class="fallback-content">
            <div class="fallback-icon">‚ö†Ô∏è</div>
            <h2>AR Not Supported</h2>
            <p class="fallback-message">Your device or browser doesn't support WebXR.</p>
            
            <div class="fallback-options">
                <h3>Recommended Browsers:</h3>
                <ul>
                    <li><strong>iOS:</strong> Safari 13+</li>
                    <li><strong>Android:</strong> Chrome 79+ with WebXR enabled</li>
                </ul>
                
                <div class="fallback-alternative">
                    <h3>View 3D Model Instead</h3>
                    <button id="view-3d-fallback" class="btn-primary">View 3D Model</button>
                </div>
            </div>
            
            <div class="device-info">
                <small id="device-details"></small>
            </div>
        </div>
    </div>

    <!-- Camera Permission Request -->
    <div id="permission-screen" class="permission-screen" style="display: none;">
        <div class="permission-content">
            <div class="permission-icon">üì∑</div>
            <h2>Camera Access Required</h2>
            <p>We need your camera to place 3D models in your space</p>
            <button id="grant-permission" class="btn-primary">Enable Camera</button>
            <p class="permission-note">We respect your privacy. Camera access is only used for AR.</p>
        </div>
    </div>

    <!-- Main AR Scene -->
    <a-scene
        id="ar-scene"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true;"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        gesture-detector
        style="display: none;">
        
        <!-- Camera with AR capabilities -->
        <a-entity id="camera-rig" position="0 0 0">
            <a-camera 
                id="main-camera"
                look-controls-enabled="false"
                wasd-controls-enabled="false">
            </a-camera>
        </a-entity>

        <!-- Lighting Setup for realistic rendering -->
        <a-entity light="type: ambient; color: #BBB; intensity: 0.8"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="-1 2 1"></a-entity>
        <a-entity light="type: hemisphere; color: #FFF; groundColor: #888; intensity: 0.5"></a-entity>

        <!-- AR Hit Test Reticle (placement indicator) -->
        <a-entity id="reticle" visible="false">
            <a-ring 
                color="#00ff88" 
                radius-inner="0.15" 
                radius-outer="0.2"
                rotation="-90 0 0"
                material="shader: flat; opacity: 0.6;">
                <a-animation 
                    attribute="scale" 
                    from="1 1 1" 
                    to="1.2 1.2 1.2" 
                    direction="alternate" 
                    dur="800" 
                    repeat="indefinite"
                    easing="ease-in-out-sine">
                </a-animation>
            </a-ring>
        </a-entity>

        <!-- 3D Model Container with gesture controls -->
        <a-entity 
            id="model-container"
            gesture-handler
            position="0 0 -2"
            scale="1 1 1"
            visible="false">
            
            <!-- Model 1: Default GLB model -->
            <a-entity
                id="model-1"
                gltf-model="url(./models/model1.glb)"
                scale="0.5 0.5 0.5"
                animation-mixer
                shadow="cast: true; receive: false">
            </a-entity>
            
            <!-- Model 2: Alternative model (hidden by default) -->
            <a-entity
                id="model-2"
                gltf-model="url(./models/model2.glb)"
                scale="0.5 0.5 0.5"
                animation-mixer
                visible="false"
                shadow="cast: true; receive: false">
            </a-entity>
        </a-entity>

        <!-- Ground plane for shadow receiving -->
        <a-plane 
            id="ground-plane"
            rotation="-90 0 0" 
            width="100" 
            height="100" 
            color="#ffffff"
            shadow="receive: true"
            visible="false"
            material="opacity: 0; transparent: true">
        </a-plane>
    </a-scene>

    <!-- UI Controls Overlay -->
    <div id="ui-controls" class="ui-controls" style="display: none;">
        
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="brand">
                <span class="brand-icon">üéØ</span>
                <span class="brand-text">WebAR</span>
            </div>
            <button id="info-btn" class="btn-icon" title="Info">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"/>
                </svg>
            </button>
        </div>

        <!-- Instructions Panel (toggleable) -->
        <div id="instructions-panel" class="instructions-panel" style="display: none;">
            <h3>How to Use</h3>
            <ul>
                <li>üëÜ <strong>Tap</strong> to place the model</li>
                <li>ü§è <strong>Pinch</strong> to scale</li>
                <li>‚ÜîÔ∏è <strong>Drag</strong> to move</li>
                <li>üîÑ <strong>Two fingers</strong> to rotate</li>
            </ul>
            <button id="close-instructions" class="btn-small">Got it</button>
        </div>

        <!-- Placement Instructions -->
        <div id="placement-hint" class="placement-hint">
            <p>üëÜ Tap anywhere to place your model</p>
        </div>

        <!-- Bottom Action Bar -->
        <div class="bottom-bar">
            
            <!-- Model Selector -->
            <div class="model-selector">
                <button class="model-btn active" data-model="model-1" title="Model 1">
                    <span class="model-icon">üé®</span>
                    <span class="model-label">Model 1</span>
                </button>
                <button class="model-btn" data-model="model-2" title="Model 2">
                    <span class="model-icon">üé≠</span>
                    <span class="model-label">Model 2</span>
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button id="screenshot-btn" class="btn-action" title="Take Screenshot">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"/>
                    </svg>
                    <span>Capture</span>
                </button>

                <button id="reset-btn" class="btn-action" title="Reset Position">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.4 10.9,20.3V22.3C13.9,22.5 17,21.4 19.2,19.2C23.1,15.3 23.1,8.7 19.2,4.8C17.3,2.9 14.7,2 12,2V4M6.3,17.6C3.2,14.5 3.2,9.4 6.3,6.3C7.8,4.8 9.9,4 12,4V2C9.3,2 6.7,2.9 4.8,4.8C0.9,8.7 0.9,15.3 4.8,19.2C7,21.4 10.1,22.5 13.1,22.3V20.3C10.7,20.4 8.2,19.5 6.3,17.6M7,13H9V11H7V13M15,11V13H17V11H15M11,15H13V9H11V15Z"/>
                    </svg>
                    <span>Reset</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Screenshot Preview -->
    <div id="screenshot-preview" class="screenshot-preview" style="display: none;">
        <div class="screenshot-content">
            <button id="close-screenshot" class="close-btn">√ó</button>
            <img id="screenshot-image" alt="AR Screenshot">
            <div class="screenshot-actions">
                <a id="download-screenshot" download="ar-capture.png" class="btn-primary">Download</a>
                <button id="share-screenshot" class="btn-secondary">Share</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>

    <!-- Main Application Logic -->
    <script src="app.js"></script>
</body>
</html>